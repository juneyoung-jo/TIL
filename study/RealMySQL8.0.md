# 05 트랜잭션과 잠금

- 잠금은 동시성을 제어하기 위한 기능이고 트랜잭션은 데이터의 정합성을 보장하기위한 기능이다.
- 트랜잭션
  - 논리적인 작업 셋 자체가 100% 적용되거(commit)나 아무것도 적용되지 않아야함(rollback)을 보장해 주는 것
  - 프로그램 코드에서 트랜잭션 범위를 최소화 해야 함. (db 서버가 높은 부하 상태로 빠지거나 위험한 상태에 빠질경우가 빈번히 발생함.)
- MySQL 엔진의 잠금
  - 글로벌 락
    - FLUSH TABLES WITH READ LOCK 명령으로 획득
    - 한 세션에서 글로벌 락을 획득하면 다른 세션에서 SELECT 를 제외한 대부붕늬 DDL 문장이나 DML 문장을 실행하는 경우 대기상태
    - MyISAM 이나 MEMORY 테이블에 대해 mysqldump로 일관된 백업을 받아야할 때 사용
  - 테이블 락
  - 네임드 락
  - 메타데이터 락
    - 데이터베이스 객체(테이블이나 뷰 등)의 이름이나 구조를 변경하는 경우 획득하는 잠금
- InnoDB 스토리지 엔진 잠금
  - 스토리지 엔진 내부에서 레코드 기반 잠금 방식을 탑재하고 있음.
  - 레코드 락
    - 인덱스의 레코드를 잠근다.
  - 갭 락
  - 넥스트 키 락
  - 자동 증가 락
    - AUTO_INCREMENT 락 이라고 하는 테이블 수준의 잠금을 사용하여 채번 함.
- 인덱스와 잠금
  - 레코드를 잠그는 것이 아니라 인덱스를 잠그는 방식으로 처리됨.
  - update 문장을 위해 적절한 인덱스 설정이 필요함.
    - 변경해야 할 문장을 찾기 위해 검색한 인덱스의 레코드를 모두 락을 걸어야 함.
- MySQL 격리 수준
  - READ UNCOMMITTED
  - READ COMMITTED
  - REPEATABLE READ
  - SERIALIZABLE
